{% extends 'base.html' %}
{% load static %}

{% block extra_title %}
  Cart
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'cart/css/cart.css' %}" />
{% endblock %}

{% block content %}
  <!-- Hero Image -->
  <div id="hero-image" class="mb-5"></div>

  <!-- Include Progress Bar Partial -->
  {% include 'partials/progress_bar.html' with progressbar_modifier='progressbar--step-1' %}

  <!-- Include Toast for messages -->
  {% include 'partials/toasts.html' %}

  <!-- Cart Content -->
  <div id="cart-content" class="container p-3 p-md-5 mt-5 mb-5">
    <h1 class="mb-4">Your Cart</h1>
    {% if cart %}
      <!-- Cart Form -->
      <form method="post" action="{% url 'cart_update' %}">
        {% csrf_token %}
        <!-- Cart Table -->
        <div class="table-responsive text-content">
          <table class="table table-striped table-hover">
            <thead class="thead-dark" id="cart-table-header">
              <tr>
                <th scope="col">Item</th>
                <th scope="col">Image</th>
                <th scope="col">Qty</th>
                <th scope="col">Price</th>
                <th scope="col">Total</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              {% for item in cart %}
                <tr>
                  <td>{{ item.product.name }}</td>
                  <td>
                    {% if item.product.image %}
                      <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="cart-item-image" style="max-width: 50px; height: auto;">
                    {% else %}
                      <img src="{% static 'images/noimage.png' %}" alt="No image available" class="cart-item-image" style="max-width: 50px; height: auto;">
                    {% endif %}
                  </td>
                  <td>
                    <!-- Quantity Input -->
                    <input type="number" name="quantity_{{ item.product.id }}" class="form-control text-content" value="{{ item.quantity }}" min="0" />
                  </td>
                  <td class="text-nowrap">€ {{ item.price }}</td>
                  <td class="text-nowrap">€ {{ item.total_price }}</td>
                  <td>
                    <a href="{% url 'cart_remove' item.product.id %}" class="button-remove" title="Remove"><i class="fa-solid fa-trash"></i></a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="d-flex flex-column align-items-end mt-1">
          <!-- Update Cart Button -->
          <button type="submit" name="action" value="update" class="button-update mb-4"><i class="fa-solid fa-pen-to-square"></i> Update Cart</button>
          <!-- Order Total -->
          <h4 class="mb-2">Cart Total: € {{ cart.cart_total }}</h4>
          <p class="text-muted mb-3">* Delivery costs will be calculated at checkout</p>
          <!-- Checkout Button -->
          <button type="submit" name="action" value="checkout" class="button-checkout">
            <i class="fa-solid fa-credit-card"></i> Checkout
            <small class="checkout-subscript"><i class="fa-solid fa-lock"></i> Secure</small>
          </button>
        </div>
      </form>
    {% else %}
      <div class="alert alert-empty" role="alert">
        <p>Your cart is empty.</p>
        <p>
          Add a <a href="{% url 'shop' %}">guidebook</a> to your cart for purchase or add a <a href="#">crashpad</a> for rent.
        </p>
      </div>
    {% endif %}
  </div>

  <!-- Hero Image -->
  <div id="hero-image2"></div>
{% endblock %}

{% block postload_js %}
  {{ block.super }}
  <script src="{% static '../static/js/toasts.js' %}"></script>
{% endblock %}
